<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Property Lookup</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: sans-serif;
      background: #e9f5e4;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }

    .lookup-box {
      background: #11641e;
      color: white;
      border-radius: 10px;
      padding: 20px;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .lookup-box h2 {
      margin-top: 0;
      font-size: 18px;
      text-align: center;
    }

    .lookup-form {
      display: flex;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .lookup-input {
      flex: 1 1 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      color: #333;
      margin-bottom: 10px;
    }

    .lookup-button {
      background-color: #f4b400;
      color: #000;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
    }

    .secure-text {
      font-size: 12px;
      text-align: center;
      margin-top: 8px;
      color: #cdeacd;
    }

    #result {
      background: #fff;
      color: #000;
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      word-wrap: break-word;
    }

    @media (min-width: 500px) {
      .lookup-form {
        flex-wrap: nowrap;
      }

      .lookup-input {
        flex: 1;
        margin-bottom: 0;
        border-radius: 8px 0 0 8px;
      }

      .lookup-button {
        width: auto;
        border-radius: 0 8px 8px 0;
        margin-left: -1px;
      }
    }
  </style>
</head>
<body>
  <div class="lookup-box">
    <h2>Get a quick and easy price:</h2>
    <form class="lookup-form" id="lookupForm">
      <input
        type="text"
        id="addressInput"
        class="lookup-input"
        placeholder="1234 Main Street..."
        required
      />
      <button type="submit" class="lookup-button">See My Price ‚Üí</button>
    </form>
    <div class="secure-text">üîí Your information is secure.</div>
    <div id="result"></div>
  </div>

  <script>
    const chunkUrls = [
      "https://raw.githubusercontent.com/digit2ai/property-data/main/properties_chunk1.json",
      "https://raw.githubusercontent.com/digit2ai/property-data/main/properties_chunk2.json",
      "https://raw.githubusercontent.com/digit2ai/property-data/main/properties_chunk3.json",
      "https://raw.githubusercontent.com/digit2ai/property-data/main/properties_chunk4.json",
      "https://raw.githubusercontent.com/digit2ai/property-data/main/properties_chunk5.json"
    ];

    async function loadAllData() {
      try {
        const responses = await Promise.all(
          chunkUrls.map(url =>
            fetch(url).then(res => {
              if (!res.ok) {
                throw new Error(`Failed to load: ${url}`);
              }
              return res.json();
            })
          )
        );
        return responses.flat();
      } catch (err) {
        console.error("Error loading property data:", err);
        throw err;
      }
    }

    document.getElementById("lookupForm").addEventListener("submit", async function (event) {
      event.preventDefault();
      const resultDiv = document.getElementById("result");
      const input = document.getElementById("addressInput").value.trim().toLowerCase();

      resultDiv.innerHTML = "Loading...";

      try {
        const data = await loadAllData();

        const match = data.find(
          (row) => row.Address && row.Address.toLowerCase().includes(input)
        );

        if (match) {
          const basePrice = 40;
          const rate = 0.005;
          const lotSize = parseFloat(match["Lot Size"] || 0);
          const total = basePrice + rate * lotSize;

          resultDiv.innerHTML = `
            <strong>Address:</strong> ${match.Address}<br>
            <strong>Lot Size:</strong> ${match["Lot Size"]} sq ft<br>
            <strong>Owner:</strong> ${match.Owner}<br>
            <strong>Type:</strong> ${match.Type}<br>
            <strong>Estimated Price:</strong> $${total.toFixed(2)}
          `;
        } else {
          resultDiv.innerHTML = "No matching property found.";
        }
      } catch (error) {
        resultDiv.innerHTML = "‚ö†Ô∏è Error loading property data. Check console for details.";
      }
    });
  </script>
</body>
</html>
